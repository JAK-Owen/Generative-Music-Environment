<!DOCTYPE html>
<html>
<body>

<button> START </button>
<script src='https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.6/Tone.js'></script>

<script>

/////////////////////////////////////////////////////
//PROBABILITY SELECTOR
////////////////////////////////////////////////////





//////////////////////////////////////////////////////
// GLOBAL SETUP
//////////////////////////////////////////////////////

Tone.Transport.bpm.value = 16.25;

const reverb = new Tone.Reverb(10).toDestination();

const delay = new Tone.FeedbackDelay("16n", 0.9).connect(reverb);

const shortReverb = new Tone.Reverb(1).toDestination();

const shortDelay = new Tone.FeedbackDelay("32n", 0.2).connect(shortReverb);

//////////////////////////////////////////////////////
// SYNTH INST 1
//////////////////////////////////////////////////////

  const synth1 = new Tone.Synth({

    "volume": -8,
  "oscillator": {
    "type": "sawtooth"
  },
  "envelope": {
    "attack": 0.8,
    "decay": 20.0,
    "sustain": 0.0,
    "release": 20.0,
  },
  "filterEnvelope": {
    "attack": 0.8,
    "decay": 20.0,
    "sustain": 0.0,
    "release": 20.0,
    "baseFrequency": 300,
    "octaves": 4
  }});

  synth1.connect(delay);

  const pattern1 =
  ['d#1','d#2', 'd#3', 'd#4'];

var index = 0;

Tone.Transport.scheduleRepeat(time => {
  repeat(time);
}, '1n');

function repeat(time) {
  let note = pattern1[Math.floor(Math.random() * pattern1.length)];
  synth1.triggerAttackRelease(note, '1n', time);
  synth1.envelope.triggerAttackRelease("1n");
  index++;
}
Tone.Transport.start();

///////////////////////////////////////////////

const synth2 = new Tone.Synth({

  "volume": -10,
"oscillator": {
  "type": "sawtooth"
},
"envelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
},
"filterEnvelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
  "baseFrequency": 300,
  "octaves": 4
}});

synth2.connect(delay);

const pattern2 =
['f#3', 'f#4'];

var index = 0;

Tone.Transport.scheduleRepeat(time => {
repeat2(time);
}, '1n');

function repeat2(time) {
let note = pattern2[Math.floor(Math.random() * pattern2.length)];
synth2.triggerAttackRelease(note, '1n', time);
synth2.envelope.triggerAttackRelease("1n");
index++;
}

///////////////////////////////////////////////

const synth3 = new Tone.Synth({

  "volume": -9,
"oscillator": {
  "type": "sawtooth"
},
"envelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
},
"filterEnvelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
  "baseFrequency": 300,
  "octaves": 4
}});

synth3.connect(delay);

const pattern3 =
['a#2', 'a#3', 'a#4'];

var index = 0;

Tone.Transport.scheduleRepeat(time => {
repeat3(time);
}, '1n');

function repeat3(time) {
let note = pattern3[Math.floor(Math.random() * pattern3.length)];
synth3.triggerAttackRelease(note, '1n', time);
synth3.envelope.triggerAttackRelease("1n");
index++;
}

///////////////////////////////////////////////

const synth4 = new Tone.Synth({

  "volume": -10,
"oscillator": {
  "type": "sawtooth"
},
"envelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
},
"filterEnvelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
  "baseFrequency": 300,
  "octaves": 4
}});

const panner4 = new Tone.Panner(-1).connect(delay);

synth4.connect(panner4);

const pattern4 =
['g#3', 'g#4'];

var index = 0;

Tone.Transport.scheduleRepeat(time => {
repeat4(time);
}, '1n');

function repeat4(time) {
let note = pattern4[Math.floor(Math.random() * pattern4.length)];
synth4.triggerAttackRelease(note, '1n', time);
synth4.envelope.triggerAttackRelease("1n");
index++;
}

///////////////////////////////////////////////

const synth5 = new Tone.Synth({

  "volume": -10,
"oscillator": {
  "type": "sawtooth"
},
"envelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
},
"filterEnvelope": {
  "attack": 0.8,
  "decay": 20.0,
  "sustain": 0.0,
  "release": 20.0,
  "baseFrequency": 300,
  "octaves": 4
}});

const panner5 = new Tone.Panner(1).connect(delay);

synth5.connect(panner5);

const pattern5 =
['c#3', 'c#4'];

var index = 0;

Tone.Transport.scheduleRepeat(time => {
repeat5(time);
}, '1n');

function repeat5(time) {
let note = pattern5[Math.floor(Math.random() * pattern5.length)];
synth5.triggerAttackRelease(note, '1n', time);
synth5.envelope.triggerAttackRelease("1n");
index++;
}

//////////////////////////////////////////////////////////////////////
//ARP INST1
//////////////////////////////////////////////////////////////////////

const arp = new Tone.MonoSynth({

  "volume": 2,
"oscillator": {
  "type": "sawtooth"
},
"envelope": {
  "attack": 0.0,
  "decay": 0.3,
  "sustain": 0.0,
  "release": 0.2,
},
"filterEnvelope": {
  "attack": 0.0,
  "decay": 0.3,
  "sustain": 0.0,
  "release": 0.2,
  "baseFrequency": 300,
  "octaves": 4
}});

arp.connect(shortDelay);

const arpPattern =
['d#2', 'd#3', 'd#4','g#3', 'g#4','c#3', 'c#4', 'a#2', 'a#3', 'a#4',
'f#3','f#4'];

var index = 0;

Tone.Transport.scheduleRepeat(time => {
repeatArp(time);
}, '64n');

function repeatArp(time) {
let note = arpPattern[Math.floor(Math.random() * arpPattern.length)];
arp.triggerAttackRelease(note, '64n', time);
arp.envelope.triggerAttackRelease("64n");
index++;
}

//////////////////////////////////////////////////////////////////////
//ARP INST2
//////////////////////////////////////////////////////////////////////

const arp2 = new Tone.MonoSynth({

  "volume": 2,
"oscillator": {
  "type": "sawtooth"
},
"envelope": {
  "attack": 0.0,
  "decay": 0.3,
  "sustain": 0.0,
  "release": 0.2,
},
"filterEnvelope": {
  "attack": 0.0,
  "decay": 0.3,
  "sustain": 0.0,
  "release": 0.2,
  "baseFrequency": 300,
  "octaves": 4
}});

arp2.connect(shortDelay);

const arp2Pattern =
['d#2', 'd#3', 'd#4','g#3', 'g#4','c#3', 'c#4', 'a#2', 'a#3', 'a#4',
'f#3','f#4'];

var index = 0;

Tone.Transport.scheduleRepeat(time => {
repeatArp2(time);
}, '32n');

function repeatArp2(time) {
let note = arp2Pattern[Math.floor(Math.random() * arp2Pattern.length)];
arp2.triggerAttackRelease(note, '32n', time);
arp2.envelope.triggerAttackRelease("32n");
index++;
}


//////////////////////////////////////////////////////////////////////

  document.querySelector('button')?.addEventListener('click', async () => {
      await Tone.start()
  })



</script>

</body>
</html>
